#!/usr/bin/env bash
###############################################################################
# notes-app-show
#
# Usage:
#   notes-app-show <id> [--folder <name>] [--properties <prop1>,<prop2>]
###############################################################################

_main() {
  local _folder_name=
  local _id=
  local _properties=
  local _script=

  while ((${#}))
  do
    local _arg="${1:-}"
    local _val="${2:-}"

    case "${_arg}" in
      --folder)
        _folder_name="${_val:-}"
        shift
        ;;
      --properties)
        if [[ -n "${1:-}" ]] && [[ ! "${1:-}" =~ ^- ]]
        then
          _properties="$(printf "%s\\n" "${_val}" | tr ',' ' ')"
        else
          return 1
        fi
        shift
        ;;
      *)
        if [[ -z "${_id:-}" ]]
        then
          _id="${_arg:-}"
        fi
        ;;
    esac

    shift
  done

  [[ -z "${_id:-}" ]] && return 1
  if [[ -z "${_folder_name:-}" ]]
  then
    _folder_name="notes.sh"
  fi

  local _script_header=
  local _script_properties=()
  local _script_name=
  local _script_footer=

  read -r -d '' _script_header <<HEREDOC
tell application "Notes"
  tell account "iCloud"
    tell folder "${_folder_name}"
      tell note ${_id}
HEREDOC
  if [[ "${_properties}" =~ id ]]
  then
    _script_properties+=("set noteId to get id")
    _script_properties+=("log noteId")
  fi

  if [[ "${_properties}" =~ container ]]
  then
    _script_properties+=("set noteContainer to get container")
  fi

  if [[ "${_properties}" =~ password\ protected ]]
  then
    _script_properties+=("set notePasswordProtected to get password protected")
  fi

  if [[ "${_properties}" =~ creation\ date ]]
  then
    _script_properties+=("set noteCreationDate to get creation date")
  fi

  if [[ "${_properties}" =~ modification\ date ]]
  then
    _script_properties+=("set noteModificationDate to get modification date")
  fi

  if [[ "${_properties}" =~ name ]]
  then
    _script_properties+=("set noteName to get name")
  fi

  if [[ "${_properties}" =~ body ]]
  then
    _script_properties+=("set noteBody to get body")
  fi

        log noteContainer
        log noteId
        log notePasswordProtected
        log noteCreationDate
        log noteModificationDate
        log noteName
        log noteBody

  read -r -d '' _script_footer <<HEREDOC
      end tell
    end tell
  end tell
end tell
HEREDOC

#   read -r -d '' _script <<HEREDOC
# tell application "Notes"
#   tell account "iCloud"
#     tell folder "${_folder_name}"
#       tell note ${_id}
#         set noteContainer to get container
#         set noteId to get id
#         set notePasswordProtected to get password protected
#         set noteCreationDate to get creation date
#         set noteModificationDate to get modification date
#         set noteName to get name
#         set noteBody to get body

#         log noteContainer
#         log noteId
#         log notePasswordProtected
#         log noteCreationDate
#         log noteModificationDate
#         log noteName
#         log noteBody
#       end tell
#     end tell
#   end tell
# end tell
# HEREDOC

  osascript -e "${_script}"
} && _main "${@:-}"
